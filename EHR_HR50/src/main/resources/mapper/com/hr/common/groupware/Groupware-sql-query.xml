<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="common.groupware">
	
	<select id="getGroupwareAppRcvMap" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT A.ENTER_CD
			, A.APPL_SEQ
			, A.TITLE
			, A.APPL_CD
			, A.APPL_YMD
			, A.APPL_SABUN
			, A.APPL_IN_SABUN
			, A.APPL_STATUS_CD
			, A.MEMO
			, A.FINISH_YN
			, A.FILE_SEQ
			, A.DOC_NO
			, B.AGREE_SABUN
			, B.AGREE_SEQ
			, B.PATH_SEQ
			, B.APPL_TYPE_CD
			, B.AGREE_STATUS_CD
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24mmss') AS AGREE_TIME
			, B.GUBUN
			, B.ORG_APP_YN
			, B.MEMO
			, B.ORG_NM
			, B.JIKCHAK_NM
			, B.JIKWEE_NM
			, B.DEPUTY_YN
			, B.DEPUTY_SABUN
			, B.DEPUTY_ORG
			, B.DEPUTY_JIKCHAK
			, B.DEPUTY_JIKWEE
			, '' AS AGREE_USER_MEMO
			, C.PROC_EXEC_YN
			, A.APPL_STATUS_CD AS AFTER_PROC_STATUS_CD
		FROM THRI103 A
			INNER JOIN THRI107 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ
				AND B.AGREE_SEQ = (SELECT MAX(AGREE_SEQ) FROM THRI107 WHERE ENTER_CD = A.ENTER_CD AND APPL_SEQ = A.APPL_SEQ)
			INNER JOIN THRI101 C ON C.ENTER_CD = A.ENTER_CD AND C.APPL_CD = A.APPL_CD
		WHERE A.APPL_SEQ = TRIM(#{applSeq})
	]]>
	</select>
	
	<select id="getGroupwareAppSndMap_HLOANApply" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT
				A.*
				-- 문서 제목 : 주택자금대여신청(성명 대여구분 대여취급) ex. 주택자금대여(황도연 구입자금 신규대여), 주택자금대여(황도연 구입자금 용도변경/증액대여)
				, '주택자금대여신청('|| F_COM_GET_NAMES(A.ENTER_CD, A.SABUN)
					||' '|| F_COM_GET_GRCODE_NAME(A.ENTER_CD, 'B83203', A.RENT_TYPE_CD)
					||' '|| F_COM_GET_GRCODE_NAME(A.ENTER_CD, 'B83202', A.HANDLE_TYPE_CD)
					||')' AS TITLE
			FROM TBEN926 A
				INNER JOIN THRI103 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ AND B.APPL_STATUS_CD <> '11'
			WHERE A.ENTER_CD = TRIM(#{ssnEnterCd})
			AND A.APPL_SEQ = TRIM(#{applSeq})
	]]>
	</select>
	
	<select id="getGroupwareAppSndMap_HWI_HLOANAPPLY" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT
			  A.NO_EMP
			, A.NO_APPLY
			, TRIM(TO_CHAR(A.AMT_HLOAN, '999,999,999,999')) AS AMT_HLOAN
			, TRIM(TO_CHAR(A.AMT_HLOANFREEINT * 0.0000001, '999,999,999,999')) AS AMT_HLOANFREEINT
			, TRIM(TO_CHAR(A.AMT_HLOANINT * 0.0000001, '999,999,999,999')) AS AMT_HLOANINT
			, A.NO_REPAYOFFSET
			, A.NO_REPAYEVENDIV
			, A.ADDR1
			, A.ADDR2
			, A.NM_OWNER
			, A.AREA
			, TRIM(TO_CHAR(A.AMT_ESTIMATE, '999,999,999,999')) AS AMT_ESTIMATE
			, TRIM(TO_CHAR(A.AMT_COLLATERAL1ST, '999,999,999,999')) AS AMT_COLLATERAL1ST
			, TRIM(TO_CHAR(A.AMT_COLLATER2ND, '999,999,999,999')) AS AMT_COLLATER2ND
			, A.NM_LOANAPPLY
			, A.NM_LOAN
			, A.NM_MONEYUSE
			, TRIM(TO_CHAR(A.TOTALRESTMONEY, '999,999,999,999')) AS TOTALRESTMONEY
			, DECODE(IS_DATE(A.DT_LOAN), 'Y', TO_CHAR(TO_DATE(A.DT_LOAN, 'YYYYMMDD'), 'YYYY/MM/DD'), A.DT_LOAN) AS DT_LOAN
			, A.NM_HOUSE
			, A.NM_STRUCTURE
			, A.RT_INTEREST
			, DECODE(IS_DATE(A.DT_EXPIRE), 'Y', TO_CHAR(TO_DATE(A.DT_EXPIRE, 'YYYYMMDD'), 'YYYY/MM/DD'), A.DT_EXPIRE) AS DT_EXPIRE
		FROM (
				SELECT
					  A.SABUN														AS NO_EMP			-- 사번: <NO_EMP>2016008</NO_EMP>
					, A.APPL_SEQ													AS NO_APPLY			-- 신청순번: <NO_APPLY>1</NO_APPLY>
					, A.RENT_AMT													AS AMT_HLOAN		-- 대여금액: <AMT_HLOAN>100,000,000</AMT_HLOAN>
					, A.COND_FREE_AMT												AS AMT_HLOANFREEINT	-- 무이자금액: <AMT_HLOANFREEINT>2</AMT_HLOANFREEINT>
					, GREATEST(NVL(A.RENT_AMT, 0) - NVL(A.COND_FREE_AMT, 0), 0)		AS AMT_HLOANINT		-- 유이자금액: <AMT_HLOANINT>15</AMT_HLOANINT>
					, A.COND_DELAY_MM/12											AS NO_REPAYOFFSET	-- 거치년수: <NO_REPAYOFFSET>2</NO_REPAYOFFSET>
					, TRUNC(A.COND_REPAY_MM/12, 0)									AS NO_REPAYEVENDIV	-- 분할상환년수: <NO_REPAYEVENDIV>13</NO_REPAYEVENDIV>
					, A.HOME_LOCATION												AS ADDR1			-- 주소1: <ADDR1>대구광역시 수성구 동대구로 59 (두산동)F동 2401호(두산동, 대우트럼프월드수성)</ADDR1>
					, ''															AS ADDR2			-- 주소2: <ADDR2>F동 2401호(두산동, 대우트럼프월드수성)</ADDR2>
					, A.HOME_OWNER													AS NM_OWNER			-- 소유자: <NM_OWNER>노주훈,김덕은</NM_OWNER>
					, A.HOME_EXCLUSIVE_AREA											AS AREA				-- 면적: <AREA>85.00</AREA>
					, A.HOME_MARKET_PRICE											AS AMT_ESTIMATE		-- 시가추정액: <AMT_ESTIMATE>595,000,000</AMT_ESTIMATE>
					, T924.PLAN_BALANCE_AMT											AS TOTALRESTMONEY	-- 총대여금: <TOTALRESTMONEY>0</TOTALRESTMONEY>
					, A.RENT_YMD													AS DT_LOAN			-- 대여일자(이체예정일): <DT_LOAN>2020/01/17</DT_LOAN>
					, F_COM_GET_GRCODE_NAME(A.ENTER_CD, 'B83202', A.HANDLE_TYPE_CD)	AS NM_LOANAPPLY		-- 신청구분: <NM_LOANAPPLY>신규대여</NM_LOANAPPLY>
					, F_COM_GET_GRCODE_NAME(A.ENTER_CD, 'B83203', A.RENT_TYPE_CD)	AS NM_LOAN			-- 대여구분: <NM_LOAN>주택구입</NM_LOAN>
					, F_COM_GET_GRCODE_NAME(A.ENTER_CD, 'B83208', A.USE_CD)			AS NM_MONEYUSE		-- 자금용도: <NM_MONEYUSE>기존주택매입</NM_MONEYUSE>
					, F_COM_GET_GRCODE_NAME(A.ENTER_CD, 'B83209', A.HOME_TYPE_CD)	AS NM_HOUSE			-- 주택종류: <NM_HOUSE>공동-아파트</NM_HOUSE>
					, ''															AS NM_STRUCTURE		-- 주택구조: <NM_STRUCTURE>독채</NM_STRUCTURE>
					, A.COND_RATE													AS RT_INTEREST		-- 이자율: <RT_INTEREST>1.700</RT_INTEREST>
					, A.EXPIRE_YMD													AS DT_EXPIRE		-- 만기일자: <DT_EXPIRE>2035/01/16</DT_EXPIRE>
					, (SELECT LIEN_AMT FROM TBEN920 WHERE ENTER_CD = A.ENTER_CD AND SABUN = A.SABUN AND SEQ = A.SEQ AND LIEN_SEQ = 1) AS AMT_COLLATERAL1ST		-- 선순위저당금액1: <AMT_COLLATERAL1ST>0</AMT_COLLATERAL1ST>
					, (SELECT LIEN_AMT FROM TBEN920 WHERE ENTER_CD = A.ENTER_CD AND SABUN = A.SABUN AND SEQ = A.SEQ AND LIEN_SEQ = 2) AS AMT_COLLATER2ND		-- 선순위저당금액2: <AMT_COLLATER2ND>0</AMT_COLLATER2ND>	
				FROM TBEN926 A
					INNER JOIN THRI103 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ AND B.APPL_STATUS_CD <> '11'
					INNER JOIN TBEN924 T924 ON T924.ENTER_CD = A.ENTER_CD AND T924.APPL_SEQ = A.APPL_SEQ
				WHERE A.ENTER_CD = TRIM(#{ssnEnterCd})
				AND A.APPL_SEQ = TRIM(#{applSeq})
			) A
	]]>
	</select>
	
	<select id="getGroupwareAppSndMap_HWI_HLOANCREDIT" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT
			  A.NO_EMP
			, A.NO_APPLY
			, TRIM(TO_CHAR(A.AMT_ESTIMATEDRETIRE, '999,999,999,999')) AS AMT_ESTIMATEDRETIRE
			, TRIM(TO_CHAR(A.AMT_ASSUREINSURE, '999,999,999,999')) AS AMT_ASSUREINSURE
			, TRIM(TO_CHAR(A.AMT_ESTIMATEDPRICE, '999,999,999,999')) AS AMT_ESTIMATEDPRICE
			, A.NM_OFFICE1ST
			, TRIM(TO_CHAR(A.AMT_CREDIT1ST, '999,999,999,999')) AS AMT_CREDIT1ST
			, A.NM_OFFICE2ND
			, TRIM(TO_CHAR(A.AMT_CREDIT2ND, '999,999,999,999')) AS AMT_CREDIT2ND
			, TRIM(TO_CHAR(A.AMT_ESTIMATEDPRICE3, '999,999,999,999')) AS AMT_ESTIMATEDPRICE3
			, A.NM_OFFICE1ST3
			, TRIM(TO_CHAR(A.AMT_CREDIT1ST3, '999,999,999,999')) AS AMT_CREDIT1ST3
			, A.NM_OFFICE2ND3
			, TRIM(TO_CHAR(A.AMT_CREDIT2ND3, '999,999,999,999')) AS AMT_CREDIT2ND3
			, A.NM_SPONSORADDR
			, A.NM_SOPNSOR
			, A.NM_SPONSORJOB
			, TRIM(TO_CHAR(A.AMT_SPONSORTAX, '999,999,999,999')) AS AMT_SPONSORTAX
			, A.NM_LOC
			, A.NM_LOC3
			, A.NM_RELATION3
			, A.NM_SPONSORREL
			, A.NM_OWNER
			, A.NM_OWNER3
		FROM (
				SELECT
					  A.SABUN														AS NO_EMP				-- 사번: <NO_EMP>2016008</NO_EMP>
					, A.APPL_SEQ													AS NO_APPLY				-- 신청순번: <NO_APPLY>1</NO_APPLY>
					, T927.PRSRV_INSR_AMT											AS AMT_ASSUREINSURE		-- 보증보험가입액:   <AMT_ASSUREINSURE>100,000,000</AMT_ASSUREINSURE>
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_ESTIMATE_AMT)	AS AMT_ESTIMATEDPRICE	-- 본인주택근저당-추정시가:   <AMT_ESTIMATEDPRICE>0</AMT_ESTIMATEDPRICE>
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_PERSON_1)		AS NM_OFFICE1ST			-- 본인주택근저장-1순위기관:   <NM_OFFICE1ST />
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_AMT_1)			AS AMT_CREDIT1ST		-- 본인주택근저장-1순위기관설정액:   <AMT_CREDIT1ST>0</AMT_CREDIT1ST>
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_PERSON_2)		AS NM_OFFICE2ND			-- 본인주택근저장-2순위기관:   <NM_OFFICE2ND />
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_AMT_2)			AS AMT_CREDIT2ND		-- 본인주택근저장-2순위기관설정액:   <AMT_CREDIT2ND>0</AMT_CREDIT2ND>
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_ESTIMATE_AMT)	AS AMT_ESTIMATEDPRICE3	-- 3자물건근저당-추정시가:   <AMT_ESTIMATEDPRICE3>0</AMT_ESTIMATEDPRICE3>
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_PERSON_1)		AS NM_OFFICE1ST3		-- 3자물건근저장-1순위기관:   <NM_OFFICE1ST3 />
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_AMT_1)			AS AMT_CREDIT1ST3		-- 3자물건근저장-1순위기관설정액:   <AMT_CREDIT1ST3>0</AMT_CREDIT1ST3>
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_PERSON_2)		AS NM_OFFICE2ND3		-- 3자물건근저장-2순위기관:   <NM_OFFICE2ND3 />
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_AMT_2)			AS AMT_CREDIT2ND3		-- 3자물건근저장-2순위기관설정액:   <AMT_CREDIT2ND3>0</AMT_CREDIT2ND3>
					, T927.JOIN_ADDR												AS NM_SPONSORADDR		-- 연대보증인-주소:   <NM_SPONSORADDR />
					, T927.JOIN_NAME												AS NM_SOPNSOR			-- 연대보증인-명:   <NM_SOPNSOR />
					, T927.JOIN_JOB													AS NM_SPONSORJOB		-- 연대보증인-직업:   <NM_SPONSORJOB />
					, T927.JOIN_PROPERTY_TAX										AS AMT_SPONSORTAX		-- 연대보증인-재산세액:   <AMT_SPONSORTAX>0</AMT_SPONSORTAX>
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_PRODUCT_AREA)	AS NM_LOC				-- 본인주택근저당-물건소재지:   <NM_LOC />
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_PRODUCT_AREA)	AS NM_LOC3				-- 3자물건근저당-물건소재지:   <NM_LOC3 />
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_RELATION_CD)	AS NM_RELATION3			-- 3자물건근저당-관계:   <NM_RELATION3 />
					, T927.JOIN_RELATION											AS NM_SPONSORREL		-- 연대보증인-관계:   <NM_SPONSORREL />
					, DECODE(T927.LIEN_RELATION_CD, '10', T927.LIEN_OWNER)			AS NM_OWNER				-- 본인주택근저당-소유자:   <NM_OWNER>노주훈,김덕은</NM_OWNER>
					, DECODE(T927.LIEN_RELATION_CD, '20', T927.LIEN_OWNER)			AS NM_OWNER3			-- 3자물건근저당-소유자:   <NM_OWNER3 />								
					--, (SELECT SUM(BB.TOT_EARNING_MON)
					--	 FROM TCPN201 AA, TCPN771 BB
					--    WHERE AA.ENTER_CD = A.ENTER_CD
					--	  AND AA.PAY_YM = TO_CHAR(ADD_MONTHS(TO_DATE(B.APPL_YMD,'YYYYMMDD'),-1),'YYYYMM')
					--	  AND AA.PAY_CD = 'S3'
					--	  AND BB.ENTER_CD = A.ENTER_CD
					--	  AND BB.SABUN = A.SABUN
					--	  AND BB.PAY_ACTION_CD = AA.PAY_ACTION_CD									   
					--	) AS AMT_ESTIMATEDRETIRE
					, A.RET_MON 													AS AMT_ESTIMATEDRETIRE -- 퇴직금추계액:   <AMT_ESTIMATEDRETIRE>26,647,460</AMT_ESTIMATEDRETIRE>																	
				FROM TBEN926 A
					INNER JOIN THRI103 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ AND B.APPL_STATUS_CD <> '11'
					LEFT OUTER JOIN TBEN927 T927 ON T927.ENTER_CD = A.ENTER_CD AND T927.SABUN = A.SABUN AND T927.RENT_SEQ = A.RENT_SEQ
						AND T927.SEQ IN (
							SELECT AA.SEQ FROM TBEN927 AA WHERE AA.ENTER_CD = A.ENTER_CD AND AA.APPL_SEQ = A.APPL_SEQ
							UNION ALL
							SELECT MAX(AA.SEQ) 
							FROM TBEN927 AA
								INNER JOIN THRI103 BB ON BB.ENTER_CD = AA.ENTER_CD AND BB.APPL_SEQ = AA.APPL_SEQ AND BB.APPL_STATUS_CD = '99'
							WHERE AA.ENTER_CD = A.ENTER_CD
							AND AA.SABUN = A.SABUN
							AND AA.RENT_SEQ = A.RENT_SEQ
							AND (SELECT COUNT(1) FROM TBEN927 WHERE ENTER_CD = A.ENTER_CD AND APPL_SEQ = A.APPL_SEQ) = 0
						)
				WHERE A.ENTER_CD = TRIM(#{ssnEnterCd})
				AND A.APPL_SEQ = TRIM(#{applSeq})
			) A
	]]>
	</select>
	
	<select id="getGroupwareAppSndMap_HWI_HLOANMST" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT
			  A.NO_EMP
			, A.NO_APPLY
			, A.NM_LOANAPPLY
			, A.NM_LOAN
			, A.NM_MONEYUSE
			, TRIM(TO_CHAR(A.AMT_HLOAN, '999,999,999,999')) AS AMT_HLOAN
			, TRIM(TO_CHAR(A.AMT_REST, '999,999,999,999')) AS AMT_REST
			, A.NO_REPAY
			, TRIM(TO_CHAR(A.AMT_MMREPAY, '999,999,999,999')) AS AMT_MMREPAY
		FROM (
				SELECT
					  A.SABUN															AS NO_EMP			-- 사번: <NO_EMP>2016008</NO_EMP>
					, A.APPL_SEQ														AS NO_APPLY			-- 신청순번: <NO_APPLY>1</NO_APPLY>
					, F_COM_GET_GRCODE_NAME(PRE.ENTER_CD, 'B83202', PRE.HANDLE_TYPE_CD)	AS NM_LOANAPPLY		-- 신청구분: <NM_LOANAPPLY>변경대여</NM_LOANAPPLY>
					, F_COM_GET_GRCODE_NAME(PRE.ENTER_CD, 'B83203', PRE.RENT_TYPE_CD)	AS NM_LOAN			-- 대여구분: <NM_LOAN>주택임차</NM_LOAN>
					, F_COM_GET_GRCODE_NAME(PRE.ENTER_CD, 'B83208', PRE.USE_CD)			AS NM_MONEYUSE		-- 자금용도: <NM_MONEYUSE>주택임차</NM_MONEYUSE>
					, T924.PRE_RENT_AMT													AS AMT_HLOAN		-- 대여금액: <AMT_HLOAN>150,000,000</AMT_HLOAN>
					, T924.PRE_RENT_AMT - T924.PRE_REPAY_AMT							AS AMT_REST			-- 잔액: <AMT_REST>87,196,000</AMT_REST>
					, T924.PRE_REPAY_E_ORD												AS NO_REPAY			-- 최종상환회차: <NO_REPAY>15</NO_REPAY>
					, T924.PLAN_REPAY_AMT												AS AMT_MMREPAY		-- 원금월상환금액: <AMT_MMREPAY>1,050,000</AMT_MMREPAY>
				FROM TBEN926 A
					INNER JOIN THRI103 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ AND B.APPL_STATUS_CD <> '11'
					INNER JOIN TBEN924 T924 ON T924.ENTER_CD = A.ENTER_CD AND T924.APPL_SEQ = A.APPL_SEQ
					INNER JOIN TBEN926 PRE ON PRE.ENTER_CD = A.ENTER_CD AND PRE.APPL_SEQ = A.PRE_APPL_SEQ
					INNER JOIN TBEN924 PRE924 ON PRE924.ENTER_CD = PRE.ENTER_CD AND PRE924.APPL_SEQ = PRE.APPL_SEQ
				WHERE A.ENTER_CD = TRIM(#{ssnEnterCd})
				AND A.APPL_SEQ = TRIM(#{applSeq})
				AND A.HANDLE_TYPE_CD NOT IN ('101', '106') -- 신규/재대여 아닌 경우
				UNION ALL
				SELECT
					  A.SABUN															AS NO_EMP			-- 사번: <NO_EMP>2016008</NO_EMP>
					, A.APPL_SEQ														AS NO_APPLY			-- 신청순번: <NO_APPLY>1</NO_APPLY>
					, ''																AS NM_LOANAPPLY		-- 신청구분: <NM_LOANAPPLY>변경대여</NM_LOANAPPLY>
					, ''																AS NM_LOAN			-- 대여구분: <NM_LOAN>주택임차</NM_LOAN>
					, ''																AS NM_MONEYUSE		-- 자금용도: <NM_MONEYUSE>주택임차</NM_MONEYUSE>
					, NULL																AS AMT_HLOAN		-- 대여금액: <AMT_HLOAN>150,000,000</AMT_HLOAN>
					, NULL																AS AMT_REST			-- 잔액: <AMT_REST>87,196,000</AMT_REST>
					, NULL																AS NO_REPAY			-- 최종상환회차: <NO_REPAY>15</NO_REPAY>
					, T924.PLAN_REPAY_AMT												AS AMT_MMREPAY		-- 원금월상환금액: <AMT_MMREPAY>1,050,000</AMT_MMREPAY>
				FROM TBEN926 A
					INNER JOIN THRI103 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ AND B.APPL_STATUS_CD <> '11'
					INNER JOIN TBEN924 T924 ON T924.ENTER_CD = A.ENTER_CD AND T924.APPL_SEQ = A.APPL_SEQ
				WHERE A.ENTER_CD = TRIM(#{ssnEnterCd})
				AND A.APPL_SEQ = TRIM(#{applSeq})
				AND A.HANDLE_TYPE_CD IN ('101', '106') -- 신규/재대여인 경우
			) A
	]]>
	</select>
	
	<select id="getGroupwareAppSndMap_HHI_PERMST01" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT
		  A.NO_EMP
		, A.NO_RES
		, A.NM_KORNAME
		, A.NO_RESZIP
		, A.NM_CURRADDR1
		, A.NM_CURRADDR2
		, A.NM_TEAM_1 ||' '|| A.NM_TEAM_2 AS NM_DEPT
		, A.NM_DEPT AS NM_TEAM
		, A.CD_HOBONG
		, A.YYYY
		, A.MM
		, A.DD
		, A.CONTINUE_YYYY
		, A.CONTINUE_MM
		, A.NM_JOBKIND
		, A.NM_JOBGRD
		, A.YN_MARRIAGE
	FROM (
			SELECT
				  A.SABUN															AS NO_EMP			-- 사번: <NO_EMP>2016008</NO_EMP>
				, SUBSTR(CRYPTIT.DECRYPT(C.RES_NO, C.ENTER_CD), 0, 6) || '-*******'	AS NO_RES			-- 주민번호:   <NO_RES>881010-*******</NO_RES>
				, C.NAME															AS NM_KORNAME		-- 성명:   <NM_KORNAME>권익정</NM_KORNAME>
				, D.SAL_CLASS														AS CD_HOBONG		-- 호봉:   <CD_HOBONG>1</CD_HOBONG>
				, SUBSTR(C.EMP_YMD, 0, 4)											AS YYYY				-- 입사년도:   <YYYY>2016</YYYY>
				, TO_NUMBER(SUBSTR(C.EMP_YMD, 5, 2))								AS MM				-- 입사월:   <MM>2</MM>
				, TO_NUMBER(SUBSTR(C.EMP_YMD, 7, 2))								AS DD				-- 입사일:   <DD>5</DD>
				, D.JIKJONG_NM														AS NM_JOBKIND		-- 직종명:   <NM_JOBKIND>일반직</NM_JOBKIND>
				, D.JIKGUB_NM														AS NM_JOBGRD		-- 직급명:   <NM_JOBGRD>4급</NM_JOBGRD>
				, DECODE(C.WED_YN, 'Y', '기혼', '미혼')								AS YN_MARRIAGE		-- 결혼여부:   <YN_MARRIAGE>기혼</YN_MARRIAGE>
				, E.ZIP																AS NO_RESZIP		-- 거주지우편번호:   <NO_RESZIP>42686</NO_RESZIP>
				, E.ADDR1															AS NM_CURRADDR1		-- 거주지주소:  <NM_CURRADDR1>대구광역시 달성군 하빈면 하빈로24길 73-3주택</NM_CURRADDR1>
				, E.ADDR2															AS NM_CURRADDR2		-- 거주지상세주소:   <NM_CURRADDR2>주택</NM_CURRADDR2>
				, F_COM_GET_ORG_NM(D.ENTER_CD, D.ORG_CD, B.APPL_YMD)								AS NM_DEPT			-- 부서명:   <NM_DEPT>금고감독위원회</NM_DEPT>
				, F_ORG_GET_ORGCD_BY_LEVEL(D.ENTER_CD, D.ORG_CD, B.APPL_YMD, 'HOI0200010','NM')	AS NM_TEAM_1		-- 부명:   <NM_TEAM>검사감독2본부 경북지역검사부</NM_TEAM>
				, F_ORG_GET_ORGCD_BY_LEVEL(D.ENTER_CD, D.ORG_CD, B.APPL_YMD, 'HOI0200020','NM')	AS NM_TEAM_2		-- 부명:   <NM_TEAM>검사감독2본부 경북지역검사부</NM_TEAM>
				, FLOOR(F_COM_GET_WORK_YM(C.ENTER_CD, C.SABUN, B.APPL_YMD) / 12)					AS CONTINUE_YYYY	-- 근속년수:   <CONTINUE_YYYY>3</CONTINUE_YYYY>
				, FLOOR(MOD(F_COM_GET_WORK_YM(C.ENTER_CD, C.SABUN, B.APPL_YMD), 12))				AS CONTINUE_MM		-- 근속월수:   <CONTINUE_MM>11</CONTINUE_MM>
			FROM TBEN926 A
				INNER JOIN THRI103 B ON B.ENTER_CD = A.ENTER_CD AND B.APPL_SEQ = A.APPL_SEQ AND B.APPL_STATUS_CD <> '11'
				INNER JOIN THRM100 C ON C.ENTER_CD = A.ENTER_CD AND C.SABUN = A.SABUN
				INNER JOIN THRM151 D ON D.ENTER_CD = A.ENTER_CD AND D.SABUN = A.SABUN AND B.APPL_YMD BETWEEN D.SDATE AND NVL(D.EDATE, '99991231')
				LEFT OUTER JOIN THRM123 E ON E.ENTER_CD = A.ENTER_CD AND E.SABUN = A.SABUN AND E.ADD_TYPE = '3' -- 현거주지
			WHERE A.ENTER_CD = TRIM(#{ssnEnterCd})
			AND A.APPL_SEQ = TRIM(#{applSeq})
		) A
	]]>
	</select>
	
	<select id="getGroupwareLogSeq" parameterType="map" resultType="cMap">
	<![CDATA[
		SELECT
			NVL((SELECT MAX(SEQ) FROM TSYS997 WHERE ENTER_CD = NVL(#{enterCd}, 'MG') AND BIZ_CD = #{bizCd}), 0) + 1 AS SEQ
			, NVL(#{enterCd}, 'MG') AS ENTER_CD
		FROM DUAL
	]]>
	</select>
	
	<insert id="saveGroupwareLog" parameterType="map">
	<![CDATA[
		INSERT INTO TSYS997(ENTER_CD, BIZ_CD, SEQ, ERR_LOG, CONTENT_LOG, SUCCESS_YN, CHKDATE, CHKID)
		VALUES(
			#{enterCd}
			, #{bizCd}
			, #{seq}
			, #{errLog}
			, EMPTY_CLOB()
			, #{successYn}
			, SYSDATE
			, #{chkid}
		)
	]]>
	</insert>
	
	<update id="updateGroupwareLog" parameterType="map">
	<![CDATA[
		UPDATE TSYS997 SET
				CONTENT_LOG = #{contentLog}
			WHERE ENTER_CD = #{enterCd}
			AND BIZ_CD = #{bizCd}
			AND SEQ = #{seq}
	]]>
	</update>
	
</mapper>